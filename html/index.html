<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>DASER</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        window.onbeforeunload = function () {
            return "You will lost your data";
        } 
    </script>
</head>

<body>

    <header>
        <span id="daser">DASER</span>
    </header>

    <div id="container">

        <div id="header-container">
            <div id="alert">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>Error!</strong> Invalid mysql command.
            </div>
            <div id="alert2">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>Invalid file.</strong> Please upload a .txt extension file with sql commands separated by /.
            </div>
            <div id="alert3">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>Invalid table name.</strong> Please use only letters.
            </div>
            <div id="alert4">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>Invalid column name.</strong> Please use only letters.
            </div>
            <div id="alert5">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>Invalid datatype value.</strong> Datatype value is only for Char and Varchar.
            </div>
            <div id="alert6">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>Invalid datatype value.</strong> Datatype value should not be empty and the value should be between 1 and
                255 for Char and Varchar.
            </div>
            <div id="alert7">
                <span class="closebtn" onclick="this.parentElement.style.display='none'">&times;</span>
                You must provide data.
            </div>
            <div id="alert8">
                <span class="closebtn" onclick="this.parentElement.style.display='none'">&times;</span>
                Warning! You can't go back, you will lose your data.
            </div>
            <div id="alert9">
                <span class="closebtn" onclick="this.parentElement.style.display='none'">&times;</span>
                Changes saved.
            </div>
            <div id="alert10">
                <span class="closebtn" onclick="this.parentElement.style.display='none'">&times;</span>
                Foreign key already exists.
            </div>

            <input type="text" id="sql-command" placeholder="SQL COMMAND" />
            <button id="element3" class="enter-button tooltip" onclick="runSQL()">
                <span class="tooltiptext">Run command</span>
                <i class="fas fa-play"></i>
            </button>
            <button class="import-button tooltip" id="custom-button">
                <span class="tooltiptext">Import SQL</span>
                <i class="fas fa-file-import"></i>
            </button>
        </div>

        <div id="container-body">
            <div class="sql-button-container tooltip" id="element1">
                <span class="tooltiptext">Create table</span>
                <button class="sql-buttons" onclick="displayCreateTable();">
                    <i class="far fa-window-maximize"></i>
                </button>
            </div>
            <div class="sql-button-container tooltip" id="element2">
                <span class="tooltiptext">Alter table</span>
                <button class="sql-buttons" onclick="displayAlterTable();">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
            <div id="createTableWindow">
                <div id="createTableWindow-header">
                    <p>CREATE TABLE</p>
                    <button class="close-button" onclick="closePopUp(event);ResetTheCreateTablePopup();">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div id="pop-up-body">
                    <label> Table name
                        <br>
                        <input type="text" id="table-name" pattern="[A-Z]+" title="Use only letters" />
                    </label>
                    <br>
                    <br>
                    <div class="table-property">
                        <div> Column name
                            <input type="text" pattern="[A-Z]+" title="Use only letters" />
                        </div>
                        <div> Datatype
                            <select>
                                <option value="TINYINT">TINYINT</option>
                                <option value="SMALLINT">SMALLINT</option>
                                <option value="MEDIUMINT">MEDIUMINT</option>
                                <option value="BIGINT">BIGINT</option>
                                <option value="INT">INT</option>
                                <option value="DATE">DATE</option>
                                <option value="DATETIME">DATETIME</option>
                                <option value="TIMESTAMP">TIMESTAMP</option>
                                <option value="TIME">TIME</option>
                                <option value="TINYTEXT">TINYTEXT</option>
                                <option value="MEDIUMTEXT">MEDIUMTEXT</option>
                                <option value="LONGTEXT">LONGTEXT</option>
                                <option value="TEXT">TEXT</option>
                                <option value="TINYBLOB">TINYBLOB</option>
                                <option value="MEDIUMBLOB">MEDIUMBLOB</option>
                                <option value="LONGBLOB">LONGBLOB</option>
                                <option value="BLOB">BLOB</option>
                                <option value="ENUM">ENUM</option>
                                <option value="CHAR">CHAR</option>
                                <option value="VARCHAR">VARCHAR</option>
                            </select>
                        </div>
                        <div> Datatype value
                            <input type="text" pattern="[0-9]+" title="Use only digits" />
                        </div>
                        <div>
                            <p>Not Null</p>
                            <input type="checkbox" class="checkbox" />
                        </div>
                    </div>
                </div>
                <div id="add-button-pop-up">
                    <button id="add-btn">+</button>
                    <button id="run-btn">></button>
                </div>
            </div>

            <div id="alterTableWindow">
                <div id="alterTableWindow-header">
                    <p>ALTER TABLE</p>
                    <button class="close-button" onclick="closePopUp(event)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="pop-up-body">
                    <div>
                        <span id="column-tab-active" onclick="requestAlterNameDatatype();">Columns</span>
                        <span id="key-tab" onclick="requestAlterPrimaryKey();">Keys</span>
                    </div>
                    <br>
                    <div id="columns-body">
                        <label> Table name
                            <br>
                            <select id="table-selection" onchange="renderColumnSelection();">
                                <option value="none">Choose a table</option>
                            </select>
                        </label>
                        <br>
                        <br>
                        <label> Column name
                            <br>
                            <select id="column-selection">
                                <option value="none">Choose a column</option>
                            </select>
                        </label>

                        <label> Data type
                            <br>
                            <select id="datatype-selection">
                                <option value="none">Choose datatype</option>
                                <option value="TINYINT">TINYINT</option>
                                <option value="SMALLINT">SMALLINT</option>
                                <option value="MEDIUMINT">MEDIUMINT</option>
                                <option value="BIGINT">BIGINT</option>
                                <option value="INT">INT</option>
                                <option value="DATE">DATE</option>
                                <option value="DATETIME">DATETIME</option>
                                <option value="TIMESTAMP">TIMESTAMP</option>
                                <option value="TIME">TIME</option>
                                <option value="TINYTEXT">TINYTEXT</option>
                                <option value="MEDIUMTEXT">MEDIUMTEXT</option>
                                <option value="LONGTEXT">LONGTEXT</option>
                                <option value="TEXT">TEXT</option>
                                <option value="TINYBLOB">TINYBLOB</option>
                                <option value="MEDIUMBLOB">MEDIUMBLOB</option>
                                <option value="LONGBLOB">LONGBLOB</option>
                                <option value="BLOB">BLOB</option>
                                <option value="ENUM">ENUM</option>
                                <option value="CHAR">CHAR</option>
                                <option value="VARCHAR">VARCHAR</option>
                            </select>
                        </label>
                        <br>
                        <label> New column name
                            <br>
                            <input type="text" id="new-column-name" />
                        </label>
                        <div class="submit-button-pop-up">
                            <button id="submit-btn" onclick="changeColumnName(event);">Submit</button>
                        </div>
                    </div>

                    <div id="key-body" onclick="renderTablesAlterPrimaryKey();">
                        <label> Table name
                            <br>
                            <select id="table-selection-pk" onchange="renderPkColumnSelection();">
                                <option value="none">Choose a table</option>
                            </select>
                        </label>
                        <br>
                        <br>
                        <br>
                        <label> Column name ( Non primary )
                            <br>
                            <select id="column-selection-non-pk">
                                <option value="none">Choose a column</option>
                            </select>
                        </label>
                        <div class="submit-pk-btn">
                            <button id="submit-btn-add-pk" onclick="setPrimary();">Set Primary</button>
                        </div>
                        <br>
                        <label> Column name ( Primary )
                            <br>
                            <select id="column-selection-pk">
                                <option value="none">Choose a column</option>
                            </select>
                        </label>
                        <div class="submit-pk-btn">
                            <button id="submit-btn-remove-pk" onclick="unsetPrimary();">Unset Primary</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="fkTableWindow">
                <div id="fkTableWindow-header">
                    <p>CREATE FOREIGN KEY</p>
                    <button class="close-button" onclick="closePopUp(event)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="pop-up-body">
                    <label> Table name
                        <br>
                        <select id="table-selection-fk" onchange="renderColumnSelectionFk();">
                            <option value="none">Choose a table</option>
                        </select>
                    </label>
                    <div id="first-fk-columns-container">
                    </div>
                    <label> Table name
                        <br>
                        <select id="table-selection-fk2" onchange="renderColumnSelectionFk2();">
                            <option value="none">Choose a table</option>
                        </select>
                    </label>
                    <div id="second-fk-columns-container">
                    </div>

                    <div class="submit-button-pop-up">
                        <button id="submit-btn-fk" onclick="requestCreateForeignKey();">Submit</button>
                    </div>
                </div>
            </div>

            <div id="deleteTableWindow">
                <div id="deleteTableWindow-header">
                    <p>DELETE TABLE</p>
                    <button class="close-button" onclick="closePopUp(event)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="pop-up-body">
                    <label> Table name
                        <br>
                        <select id="table-delete-selection" onchange="renderReferencedTables()">
                            <option value="none">Choose a table</option>
                        </select>
                    </label>
                    <div id="referencedTables"></div>
                    <div class="submit-button-pop-up">
                        <button id="delete-btn" onclick="requestDelete()">Delete</button>
                    </div>
                    <div id="delete-pop-up-window">
                        <p>Warning! The following referenced tables will be also deleted. Are you sure ?
                        </p>
                        <button onclick="confirmDelete()">Confirm</button>
                        <button onclick="cancelDelete()">Cancel</button>
                    </div>
                </div>
            </div>
            <div id="infoWindow">
                <div id="infoWindow-header">
                    <p>INFO</p>
                    <button class="close-button" onclick="closePopUp(event)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="infoWindow-text-container">
                    <!-- adaug infoooo despre aplicatie^^ -->
                    <h3>How to use this application :</h3>
                    <ol class="ol-uncountable">
                        <li>
                            1. You can create a table in different ways.
                        </li>
                        <li class="sub-li-element"> The first and the most used one is from the
                            <span onmouseenter="HighlightElementOn('element1');"
                                onmouseleave="HighlightElementOff('element1');">Create table button.</span>
                        </li>
                        <li class="sub-li-element"> Inside the pop-up that gets open, you need to fill the fields in order to create a table.</li>
                        <li class="sub-li-element"> If you want to add more columns, press the Add column button.</li>
                        <li class="sub-li-element"> Once all the fields are filled in, press the Submit button and see the results.</li>
                        <li class="sub-li-element"> If an error occurs, a small toastr will appear with a specific message.</li>
                        <li class="sub-li-element"> Another way to create a table is by executing a sql command. This command can be written inside
                            <span
                                onmouseenter="HighlightElementOn('sql-command');" onmouseleave="HighlightElementOff('sql-command');">Sql command input</span>, and in order to run it, press the
                            <span onmouseenter="HighlightElementOn('element3');"
                                onmouseleave="HighlightElementOff('element3');">Run command button</span>.</li>
                        <li class="sub-li-element"> The last way to create a table is by importing the proper command into the app. This can be done
                            using the
                            <span onmouseenter="HighlightElementOn('custom-button');" onmouseleave="HighlightElementOff('custom-button');">Import Sql command button</span>
                        </li>
                        <li>
                            2. You can alter a table in different ways.
                        </li>
                        <li class="sub-li-element"> The first and the most used one is from the
                            <span onmouseenter="HighlightElementOn('element2');"
                                onmouseleave="HighlightElementOff('element2');">Alter table button.</span>
                        </li>
                        <li class="sub-li-element"> Inside the pop-up that gets open, you need to fill the fields in order to alter a table.</li>
                        <li class="sub-li-element"> Once all the fields are filled in, press the Submit button and see the results.</li>
                        <li class="sub-li-element"> If you want to add alter keys, press the Keys button.</li>
                        <li class="sub-li-element"> You can set a column to be a primary key, or unset it from being primary key. Once picked the desired
                            table, select the column which needs to be set or unset as primary key, and press the button
                            underneath the dropdown.</li>
                        <li class="sub-li-element"> If an error occurs, a small toastr will appear with a specific message.</li>
                        <li class="sub-li-element"> Another way to alter a table is by executing a sql command. This command can be written inside
                            <span
                                onmouseenter="HighlightElementOn('sql-command');" onmouseleave="HighlightElementOff('sql-command');">Sql command input</span>, and in order to run it, press the
                            <span onmouseenter="HighlightElementOn('element3');"
                                onmouseleave="HighlightElementOff('element3');">Run command button</span>.</li>
                        <li class="sub-li-element"> The last way to alter a table is by importing the proper command into the app. This can be done using
                            the
                            <span onmouseenter="HighlightElementOn('custom-button');" onmouseleave="HighlightElementOff('custom-button');">Import Sql command button</span>
                        </li>
                        <li>
                            3. You can create a foreign key in different ways.
                        </li>
                        <li class="sub-li-element"> The first and the most used one is from the
                            <span onmouseenter="HighlightElementOn('element4');"
                                onmouseleave="HighlightElementOff('element4');">Create foreign key button.</span>
                        </li>
                        <li class="sub-li-element"> Inside the pop-up that gets open, you need to fill the fields in order to create a foreign key.</li>
                        <li class="sub-li-element"> Once all the fields are filled in, press the Submit button and see the results.</li>
                        <li class="sub-li-element"> If an error occurs, a small toastr will appear with a specific message.</li>
                        <li class="sub-li-element"> Another way to create a foreign key is by executing a sql command. This command can be written inside
                            <span onmouseenter="HighlightElementOn('sql-command');" onmouseleave="HighlightElementOff('sql-command');">Sql command input</span>, and in order to run it, press the
                            <span onmouseenter="HighlightElementOn('element3');"
                                onmouseleave="HighlightElementOff('element3');">Run command button</span>.</li>
                        <li class="sub-li-element"> The last way to create a foreign key is by importing the proper command into the app. This can be
                            done using the
                            <span onmouseenter="HighlightElementOn('custom-button');" onmouseleave="HighlightElementOff('custom-button');">Import Sql command button</span>
                        </li>
                        <li>
                            4. You can delete a table in different ways.
                        </li>
                        <li class="sub-li-element"> The first and the most used one is from the
                            <span onmouseenter="HighlightElementOn('element5');"
                                onmouseleave="HighlightElementOff('element5');">Delete button.</span>
                        </li>
                        <li class="sub-li-element"> Inside the pop-up that gets open, you need to select the table that you want to delete.</li>
                        <li class="sub-li-element"> Press the Submit button and see the results.</li>
                        <li class="sub-li-element"> If an error occurs, a small toastr will appear with a specific message.</li>
                        <li class="sub-li-element"> Another way to delete a table is by executing a sql command. This command can be written inside
                            <span
                                onmouseenter="HighlightElementOn('sql-command');" onmouseleave="HighlightElementOff('sql-command');">Sql command input</span>, and in order to run it, press the
                            <span onmouseenter="HighlightElementOn('element3');"
                                onmouseleave="HighlightElementOff('element3');">Run command button</span>.</li>
                        <li class="sub-li-element"> The last way to delete a table is by importing the proper command into the app. This can be done
                            using the
                            <span onmouseenter="HighlightElementOn('custom-button');" onmouseleave="HighlightElementOff('custom-button');">Import Sql command button</span>
                        </li>
                        <li>
                            5. You can export the database schema view as an SVG.
                        </li>
                        <li class="sub-li-element"> In order to export the database schema as an SVG, you need to click the
                            <span onmouseenter="HighlightElementOn('element7');"
                                onmouseleave="HighlightElementOff('element7');">Export as Svg button.</span>
                        </li>
                        <li>
                            6. You can export the commands needed to create the database schema.
                        </li>
                        <li class="sub-li-element"> In order to export the sql commands related to the database schema built in our app, you need to
                            click the
                            <span onmouseenter="HighlightElementOn('element6');" onmouseleave="HighlightElementOff('element6');">Export Sql Commands button.</span>
                        </li>
                        <li>
                            7. You can move tables, zoom in and out in the database schema view.
                        </li>
                        <li class="sub-li-element"> In order to zoom in/out, you can use the mouse wheel, or the
                            <span onmouseenter="HighlightElementOn('element8');HighlightElementOn('element9');"
                                onmouseleave="HighlightElementOff('element8');HighlightElementOff('element9');">Zoom In/Out buttons</span>.</li>
                        <li class="sub-li-element"> In order to move all the tables, double click and drag inside the database schema view.</li>
                        <li class="sub-li-element"> If you want to move just one table, double click on that table and drag it into the desired place.</li>
                    </ol>
                </div>
            </div>

            <div class="sql-button-container tooltip" id="element4">
                <span class="tooltiptext">Create foreign key</span>
                <button class="sql-buttons" onclick="displayFkWindow()">
                    <i class="fas fa-project-diagram"></i>
                </button>
            </div>

            <div class="sql-button-container tooltip" id="element5">
                <span class="tooltiptext">Delete</span>
                <button class="sql-buttons" onclick="displayDeleteWindow()">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>

            <div class="sql-button-container tooltip" id="element8">
                <span class="tooltiptext">Zoom in</span>
                <button class="sql-buttons" onclick="zoomIn()">
                    <i class="fas fa-search-plus"></i>
                </button>
            </div>

            <div class="sql-button-container tooltip" id="element9">
                <span class="tooltiptext">Zoom out</span>
                <button class="sql-buttons" onclick="zoomOut()">
                    <i class="fas fa-search-minus"></i>
                </button>
            </div>

            <div class="sql-button-container-right tooltip" id="element6">
                <span class="tooltiptext">Export SQL commands</span>
                <button class="sql-buttons" onclick="exportSqlCommands()">
                    <i class="fas fa-file-code"></i>
                </button>
            </div>

            <div class="sql-button-container-right tooltip" id="element7">
                <span class="tooltiptext">Export as SVG</span>
                <button class="sql-buttons" onclick="saveSvg('schema-svg','schema.svg');">
                    <i class="fas fa-image"></i>
                </button>
            </div>

            <div class="sql-button-container-right tooltip">
                <span class="tooltiptext">Info</span>
                <button class="sql-buttons" onclick="displayInfoWindow()">
                    <i class="fas fa-info-circle"></i>
                </button>
            </div>
        </div>

        <svg id="schema-svg" width="calc(100% - 6px)" height="720" style="background-color:#1e4f60;">
            <svg id="group-svg" x="0" y="0" style="overflow: visible;">
                <g id="group-svg-objects">
                </g>
            </svg>
        </svg>


    </div>
    <script type="module" src="../javascript/svg-transforms.js"></script>
    <script src="../javascript/svg-zoom.js"></script>
    <script src="../javascript/svg-export.js"></script>
    <script src="../javascript/highlightElements.js"></script>
    <script type="module" src="../javascript/createTablePopup.js"></script>
    <script type="module" src="../javascript/buttonsFunctionality.js"></script>
    <script type="module" src="../javascript/displayWindows.js"></script>
    <script type="module" src="../javascript/script.js"></script>
    <script type="module" src="../javascript/importSql.js"></script>
    <input type="file" id="real-file" accept="text/plain" hidden="hidden" />
</body>

</html>